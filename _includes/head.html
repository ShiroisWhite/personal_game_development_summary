<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
{%- seo -%}
<link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
{%- feed_meta -%}

<!-- 支持GitHub格式的MathJax配置 -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [
      ['$`', '`$'],    // GitHub格式 - 第一优先级
      ['$', '$'],      // 标准格式
      ['\\(', '\\)']   // 括号格式
    ],
    displayMath: [
      ['$$', '$$'], 
      ['\\[', '\\]']
    ],
    processEscapes: true,
    processEnvironments: true,
    packages: ['base', 'ams']
  },
  startup: {
    ready: function () {
      console.log('MathJax with GitHub format support loaded');
      MathJax.startup.defaultReady();
    }
  }
};
</script>

<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

{%- if jekyll.environment == 'production' and site.google_analytics -%}
  {%- include google-analytics.html -%}
{%- endif -%}


<!-- 修复后的GitHub格式预处理脚本 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(function() {
    console.log('开始处理GitHub格式公式');
    
    try {
      const elements = document.querySelectorAll('p, div, span, li, td, th, h1, h2, h3, h4, h5, h6');
      console.log('找到元素数量:', elements.length);
      
      let foundGitHubFormat = false;
      
      elements.forEach(function(element, index) {
        const originalHTML = element.innerHTML;
        
        // 匹配被Jekyll处理后的格式
        let newHTML = originalHTML
          .replace(/\$<em>([^<]+)<\/em>\$/g, '$$$1$')              // $<em>公式</em>$
          .replace(/\$<strong>([^<]+)<\/strong>\$/g, '$$$1$')      // $<strong>公式</strong>$
          .replace(/\$<code>([^<]+)<\/code>\$/g, '$$$1$')          // $<code>公式</code>$
          .replace(/\$<i>([^<]+)<\/i>\$/g, '$$$1$')                // $<i>公式</i>$
          .replace(/\$<b>([^<]+)<\/b>\$/g, '$$$1$');               // $<b>公式</b>$
        
        if (newHTML !== originalHTML) {
          console.log('在元素', index, '发现并转换GitHub格式');
          console.log('原始HTML:', originalHTML);
          console.log('转换后HTML:', newHTML);
          element.innerHTML = newHTML;
          foundGitHubFormat = true;
        }
      });
      
      console.log('处理完成，找到GitHub格式:', foundGitHubFormat);
      
      if (foundGitHubFormat && window.MathJax) {
        console.log('开始重新渲染MathJax');
        MathJax.typesetPromise().then(() => {
          console.log('MathJax重新渲染完成');
        }).catch((err) => {
          console.error('MathJax渲染错误:', err);
        });
      } else if (!foundGitHubFormat) {
        console.log('未找到GitHub格式公式');
      }
      
    } catch (error) {
      console.error('脚本执行出错:', error);
    }
  }, 1000);
});
</script>
