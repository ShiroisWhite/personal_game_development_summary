<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
{%- seo -%}
<link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
{%- feed_meta -%}

<!-- 支持GitHub格式的MathJax配置 -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [
      ['$`', '`$'],    // GitHub格式 - 第一优先级
      ['$', '$'],      // 标准格式
      ['\\(', '\\)']   // 括号格式
    ],
    displayMath: [
      ['$$', '$$'], 
      ['\\[', '\\]']
    ],
    processEscapes: true,
    processEnvironments: true,
    packages: ['base', 'ams']
  },
  startup: {
    ready: function () {
      console.log('MathJax with GitHub format support loaded');
      MathJax.startup.defaultReady();
    }
  }
};
</script>

<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

{%- if jekyll.environment == 'production' and site.google_analytics -%}
  {%- include google-analytics.html -%}
{%- endif -%}

<!-- 增强调试的GitHub格式预处理脚本 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(function() {
    console.log('开始处理GitHub格式公式');
    
    try {
      // 获取所有可能包含数学公式的元素
      const elements = document.querySelectorAll('p, div, span, li, td, th, h1, h2, h3, h4, h5, h6');
      console.log('找到元素数量:', elements.length);
      
      let foundGitHubFormat = false;
      let processedCount = 0;
      
      elements.forEach(function(element, index) {
        try {
          const originalHTML = element.innerHTML;
          
          // 详细日志
          if (originalHTML.includes('$`')) {
            console.log(`元素${index}包含$\`:`, originalHTML);
          }
          if (originalHTML.includes('`$')) {
            console.log(`元素${index}包含\`$:`, originalHTML);
          }
          
          // 检查是否包含完整的GitHub格式
          if (originalHTML.includes('$`') && originalHTML.includes('`$')) {
            console.log('发现GitHub格式公式 在元素', index, ':', originalHTML);
            
            // 将 $`公式`$ 转换为 $公式$
            let newHTML = originalHTML.replace(/\$`([^`]+)`\$/g, '$$$1$');
            
            if (newHTML !== originalHTML) {
              element.innerHTML = newHTML;
              foundGitHubFormat = true;
              console.log('转换成功:', newHTML);
            } else {
              console.log('转换失败，原HTML:', originalHTML);
            }
          }
          
          processedCount++;
        } catch (elementError) {
          console.error('处理元素时出错:', elementError);
        }
      });
      
      console.log('处理完成，共处理元素:', processedCount);
      console.log('是否找到GitHub格式:', foundGitHubFormat);
      
      // 如果找到了GitHub格式，重新渲染MathJax
      if (foundGitHubFormat && window.MathJax) {
        console.log('开始重新渲染MathJax');
        MathJax.typesetPromise().then(() => {
          console.log('MathJax重新渲染完成');
        }).catch((err) => {
          console.error('MathJax渲染错误:', err);
        });
      } else {
        console.log('未找到GitHub格式公式，或MathJax未加载');
      }
      
    } catch (error) {
      console.error('脚本执行出错:', error);
    }
  }, 1000);
});
</script>
